// Generated by CoffeeScript 1.8.0
(function() {
  var Application, Collection;

  Application = require('./application');

  module.exports = Collection = (function() {
    var _isNumber;

    _isNumber = function(n) {
      return !isNaN(parseFloat(n)) && isFinite(n);
    };

    function Collection(applicationsResource, client, callback) {
      this.resource = function() {
        return applicationsResource;
      };
      this.client = function() {
        return client;
      };
      this._list = null;
      this._hash = null;
    }

    Collection.prototype.loadCollection = function(props, callback) {
      if (arguments.length === 1) {
        callback = arguments[0];
        props = {};
      }
      return this.resource().list((function(_this) {
        return function(error, resourceArray) {
          var key, model, _i, _len, _ref;
          if (error) {
            return callback(error);
          }
          _this._list = resourceArray.map(function(resource) {
            return new _this.type(resource, _this.client(), props);
          });
          if (_this.key) {
            _this._hash = {};
            _ref = _this._list;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              model = _ref[_i];
              key = model.resource()[_this.key];
              _this._hash[key] = model;
            }
          }
          return callback(null, _this);
        };
      })(this));
    };

    Collection.prototype.refresh = function(callback) {
      return this.loadCollection(callback);
    };

    Collection.prototype.add = function(model) {
      var key;
      if (this.key != null) {
        key = model.resource()[this.key];
        this._hash[key] = model;
      }
      return this._list.push(model);
    };

    Collection.prototype.get = function(key) {
      var model;
      if (!key) {
        return this._list;
      }
      if (_isNumber(key)) {
        model = this._list[key];
      } else {
        model = this._hash[key];
      }
      if (model != null) {
        return model;
      } else {
        throw new Error("No object in the " + this.type.name + "s collection for that value.");
      }
    };

    Collection.prototype.getAll = function() {
      return this._list;
    };

    return Collection;

  })();

}).call(this);
