// Generated by CoffeeScript 1.9.2
(function() {
  var Client, Context, MAINNET_URL, NETWORKS, Patchboard, SANDBOX_URL;

  Patchboard = require("patchboard-js");

  Context = require("./context");

  Client = require("./client");

  MAINNET_URL = "https://api.gem.co";

  SANDBOX_URL = "https://api-sandbox.gem.co";

  NETWORKS = {
    testnet: "bitcoin_testnet",
    bitcoin_testnet: "bitcoin_testnet",
    testnet3: "bitcoin_testnet",
    bitcoin: "bitcoin",
    mainnet: "bitcoin"
  };

  module.exports = {
    client: function(options, callback) {
      var network, url;
      if (arguments.length === 1) {
        callback = arguments[0];
        options = {};
      }
      if (options == null) {
        options = {};
      }
      network = NETWORKS[options.network] || "bitcoin_testnet";
      url = options.url || (network === 'bitcoin' ? MAINNET_URL : SANDBOX_URL);
      if (this.patchboard != null) {
        return callback(null, new Client(this.patchboard.spawn(), network));
      } else {
        return Patchboard.discover(url, {
          context: Context
        }, (function(_this) {
          return function(error, patchboard) {
            _this.patchboard = patchboard;
            if (callback) {
              return callback(error, new Client(_this.patchboard, network));
            }
          };
        })(this));
      }
    }
  };

}).call(this);
